<!DOCTYPE html>
<html>
  <head>
    <title>ActivityPub</title>
    <meta charset="utf-8">
    <script src="https://www.w3.org/Tools/respec/respec-w3c-common"
            async class="remove"></script>
    <script class="remove">
      var respecConfig = {
          specStatus: "ED",
          publishDate: "2018-01-23",
          previousPublishDate: "2018-01-23",
          previousMaturity: "REC",
          license: "w3c-software-doc",
          shortName:  "activitypub",
          wg: "Social Web Working Group",
          wgURI: "https://www.w3.org/Social/WG",
          wgPublicList: "public-socialweb",
          wgPatentURI: "https://www.w3.org/2004/01/pp-impl/72531/status",
          edDraftURI: "https://w3c.github.io/activitypub/",
          testSuiteURI: "https://test.activitypub.rocks/",
          errata: "https://www.w3.org/wiki/ActivityPub_errata",
          implementationReportURI: "https://activitypub.rocks/implementation-report",
          otherLinks: [
              {
                  "key": "Repository",
                  "data": [
                      {
                          "value": "Git repository",
                          "href": "https://github.com/w3c/activitypub",
                      },
                      {
                          "value": "Issues",
                          "href": "https://github.com/w3c/activitypub/issues",
                      },
                      {
                          "value": "Commits",
                          "href": "https://github.com/w3c/activitypub/commits/gh-pages",
                      }
                  ]
              }
          ],
          editors: [
                {
                    name:       "Christopher Lemmer Webber",
                    url:        "https://dustycloud.org/",
                    w3cid:      "57007"
                },
                {
                    name:       "Jessica Tallon",
                    url:        "https://tsyesika.se",
                    w3cid:      "72695"
                },
          ],
          authors: [
              {
                  name: "Christopher Lemmer Webber",
                  url:  "https://dustycloud.org/"
              },
              {
                  name: "Jessica Tallon",
                  url:  "https://tsyesika.se"
              },
              {
                  name: "Erin Shepherd",
                  url: "http://erinshepherd.net/"
              },
              {
                  name: "Amy Guy",
                  url: "https://rhiaro.co.uk/"
              },
              {
                  name: "Evan Prodromou",
                  url: "https://en.wikipedia.org/wiki/Evan_Prodromou"
              }
          ],
          localBiblio:  {
            "ActivityStreams": {
              title:    "Activity Streams 2.0",
              href:     "https://www.w3.org/TR/activitystreams-core/",
              authors:  [
                "J. Snell",
              ],
              status:   "Editors Draft",
              publisher:  "ActivityStreams Working Group",
            },
            "Activity-Vocabulary": {
              title:    "Activity Vocabulary",
              href:     "https://www.w3.org/TR/activitystreams-vocabulary/",
              authors:  [
                "J. Snell",
              ],
              status:   "Editors Draft",
              publisher:  "ActivityStreams Working Group",
            },
            "OAuth-Server-Metadata": {
              title:    "OAuth 2.0 Authorization Server Metadata",
              href:     "https://tools.ietf.org/html/draft-ietf-oauth-discovery-06",
              authors:  [
                "M. Jones",
                "N. Sakimura",
                "J. Bradley"
              ],
              status:   "Internet-Draft",
              publisher:  "OAuth Working Group",
            },
        },
      };
    </script>
    <style type="text/css">
      img {
          max-width: 100%;
      }
    </style>
  </head>
  <body>
    <section id="abstract">
      <p>
        ActivityPub プロトコルは、[[!ActivityStreams]] 2.0 データフォーマットに基いた非中央集権的なソーシャルネットワーキングプロトコルです。
        内容の作成、更新、削除を行うためにクライアントから呼び出すサーバーの API と、通知や内容を伝達するために連合したサーバーが呼び出すサーバーの API を提供します。
      </p>
    </section>

    <section id="sotd">
    </section>

    <section id="Overview">
      <h2>概要</h2>

      <p>ActivityPub は次の2つのレイヤーを提供します：</p>

      <ul>
        <li>
          <b>サーバー間での連合のプロトコル</b>
          (非中央集権的なウェブサイトが情報を共有することを可能にする)
        </li>
        <li>
          <b>クライアント-サーバー間でのプロトコル</b>
          (実世界の利用者、ボット、その他の自動化された処理などのユーザーが、携帯電話やデスクトップ、Web アプリケーション等からサーバー上のアカウントで ActivityPub を用いた伝達を可能にする)
        </li>
      </ul>

      <p>
        ActivityPub を実装するにあたっては、これらのどちらか一方のみ、または両方を実装することが可能です。
        しかしながら、片方が実装できていれば、もう片方を実装するのに多くの手間はかからず、両者によるメリットを得ることができます（ウェブサイトを非中央集権的なソーシャルウェブの一部にしたり、幅広いソーシャルウェブサイトで動作するクライアントやそのライブラリを使えるようになる）。
      </p>

      <p>
        ActivityPub では、ユーザーのことを、サーバー上のユーザーを介して「<a href="#actors">actor</a>」で表現されます。異なるサーバー上のユーザーのアカウントは、異なる actor に対応します。
        それぞれの actor は次の要素を持ちます：
      </p>

      <ul>
        <li><b><code>inbox</code>:</b>  外界からメッセージを受け取る部分</li>
        <li><b><code>outbox</code>:</b> 他人へとメッセージを送る部分</li>
      </ul>

      <p>
        <img src="illustration/tutorial-1.png"
             alt="inbox と outbox に並ぶ actor" />
      </p>

      <p>
        これらは、エンドポイントだったり、実際には ActivityPub の actor の ActivityStreams での説明に列挙されているただの URL であったりします（ActivityStreams について後にもう少し説明あり）。
      </p>

      <p>
        これは、我々の友達である Alyssa P. Hacker のレコードの一例です：
      </p>

      <pre class="example highlight json">
  {"@context": "https://www.w3.org/ns/activitystreams",
   "type": "Person",
   "id": "https://social.example/alyssa/",
   "name": "Alyssa P. Hacker",
   "preferredUsername": "alyssa",
   "summary": "Lisp のオタク / MIT にいます",
   "inbox": "https://social.example/alyssa/inbox/",
   "outbox": "https://social.example/alyssa/outbox/",
   "followers": "https://social.example/alyssa/followers/",
   "following": "https://social.example/alyssa/following/",
   "liked": "https://social.example/alyssa/liked/"}
      </pre>

      <p>
        ActivityPub は [[!ActivityStreams]] の語彙を用います。
        これはとても良いことで、なぜなら ActivityStreams はソーシャルネットワークで流れるすべての activity や内容を表現するのに必要な、共通したあらゆる表現を含んでいるからです。
        おそらく、ActivityStreams はあなたが必要とする語彙すべてをすでに含んでいると考えられますが、もしそうでなかったとしても、[[!JSON-LD]] を介して ActivityStreams を拡張できます。
        JSON-LD のことを知っているなら、JSON-LD によって提供されるすてきな linked data の手法によるメリットを得られます。
        もし知らなかったとしても、落ち込む必要はありません。JSON-LD ドキュメントと ActivityStreams は普通のシンプルな JSON として解釈できます
        （拡張を追加しようとするときに、JSON-LD が非常に助けとなってくれるのです）。
      </p>

      <p>
        さて、Alyssa は友達に話し掛けたいと思っていて、彼女の友達もまた彼女に話し掛けたいと思っています！
        幸運なことに、これらの "inbox" と "outbox" というものが私たちの助けとなります。両者は GET と POST に対して異なる働きをします。どのように動くのか見てみましょう：</p>
      <p>
        <img src="illustration/tutorial-2.png"
             alt="外界から inbox へ流れるメッセージと、outbox から外界へ流れるメッセージに並ぶ actor" />
      </p>

      <p>
        要約すると：
      </p>

      <ul>
        <li>
          誰かの inbox に対して POST をすると、メッセージを送ることができる
          （サーバー間 / 連合でのみ…… これこそが連合です！）
        </li>
        <li>
          自分の inbox に対して GET をすると、最新のメッセージを読むことができる
          （クライアント-サーバー間。これはソーシャルネットワークのストリームを読むようなものです）
        </li>
        <li>
          自分の outbox に対して POST をすると、外界にメッセージを送ることができる
          （クライアント-サーバー間）
        </li>
        <li>
          誰かの outbox に対して GET をすると、彼らが何を投稿したか見ることができる
          （少なくとも、見ることを認可されているものについて。クライアント-サーバー間、およびサーバー間）
        </li>
      </ul>

      <p>
        もちろん、最後のもの（誰かの outbox に対して GET すること）だけが人々の投稿を見るための方法だったら、あまり効率的な連合のプロトコルにはならないでしょう！
        実際、連合そのものは、サーバー同士が actor から actor へのメッセージをほかのサーバー上の inbox に送ることで起きています。
      </p>

      <p>
        例を見てみましょう！
        Alyssa が彼女の友達である Ben Bitdiddle の近況を知りたいと思ったとします。彼女は彼に最近本を貸したので、彼がそれを返すことを確かめておきたいです。
        これは、彼女が綴ったメッセージを、ActivityStreams のオブジェクトとして表現したものです：
      </p>

      <pre class="example highlight json">
  {"@context": "https://www.w3.org/ns/activitystreams",
   "type": "Note",
   "to": ["https://chatty.example/ben/"],
   "attributedTo": "https://social.example/alyssa/",
   "content": "そうだ、私が貸したあの本は読み終わった？"}
      </pre>

      <p>
        これは Ben に向けた note です。
        彼女は、これを自身の outbox に POST します。
      </p>

      <p>
        <img src="illustration/tutorial-3.png"
             alt="outbox にメッセージを POST する actor" />
      </p>

      <p>
        これは activity ではないオブジェクトなので、サーバーはこれが新たに作られたオブジェクトであると認識し、Create activity に包むという特別な扱い方をします
        （ActivityPub において送信される activity は、一般的に、actor がもたらす何らかのオブジェクトによる何らかの activity、というパターンに従います。
        この場合での activity は、Person によって投稿された Note オブジェクトの Create になります）。
      </p>


      <pre class="example highlight json">
  {"@context": "https://www.w3.org/ns/activitystreams",
   "type": "Create",
   "id": "https://social.example/alyssa/posts/a29a6843-9feb-4c74-a7f7-081b9c9201d3",
   "to": ["https://chatty.example/ben/"],
   "actor": "https://social.example/alyssa/",
   "object": {"type": "Note",
              "id": "https://social.example/alyssa/posts/49e2d03d-b53a-4c4c-a95c-94a6abf45a19",
              "attributedTo": "https://social.example/alyssa/",
              "to": ["https://chatty.example/ben/"],
              "content": "そうだ、私が貸したあの本は読み終わった？"}}
      </pre>

      <p>
        Alyssa のサーバーが Ben の ActivityStreams の actor オブジェクトを探し、彼の inbox エンドポイントを見つけ、彼女のオブジェクトを彼の inbox に POST します。
      </p>

      <p>
        <img src="illustration/tutorial-4.png"
             alt="外部の actor の inbox に送信するサーバー" />
      </p>

      <p>
        厳密には、これらは2つの別々のステップです…… 一つ目はクライアント-サーバー間の伝達であり、二つ目はサーバー間での伝達（連合）です。
        しかし、この例では両者を使っているので、このことを outbox から inbox への投稿の流れとして抽象的に捉えることができます。
      </p>

      <p>
        <img src="illustration/tutorial-5.png"
             alt="ある actor の outbox から他の actor の inbox へ流れる note" />
      </p>

      <p>
        すばらしい！
        少し間を置いて、Alyssa は彼女への新しいメッセージを確認します。
        彼女の携帯は GET で自身の inbox にポーリングし、友達が投稿した大量の猫動画や、姉妹が投稿した甥の写真などの中から、次のものを見つけました：
      </p>

      <pre class="example highlight json">
  {"@context": "https://www.w3.org/ns/activitystreams",
   "type": "Create",
   "id": "https://chatty.example/ben/p/51086",
   "to": ["https://social.example/alyssa/"],
   "actor": "https://chatty.example/ben/",
   "object": {"type": "Note",
              "id": "https://chatty.example/ben/p/51085",
              "attributedTo": "https://chatty.example/ben/",
              "to": ["https://social.example/alyssa/"],
              "inReplyTo": "https://social.example/alyssa/posts/49e2d03d-b53a-4c4c-a95c-94a6abf45a19",
              "content": "&lt;p&gt;あー、うん、ごめん、明日返すよ。&lt;/p&gt;
                          &lt;p&gt;レジスタマシンの章を見直していたんだ、
                             以前に書いてからだいぶ経ってしまったからね。&lt;/p&gt;"}}
      </pre>

      <p>Alyssa は安心したので、Ben の投稿に like をつけます：</p>

      <pre class="example highlight json">
  {"@context": "https://www.w3.org/ns/activitystreams",
   "type": "Like",
   "id": "https://social.example/alyssa/posts/5312e10e-5110-42e5-a09b-934882b3ecec",
   "to": ["https://chatty.example/ben/"],
   "actor": "https://social.example/alyssa/",
   "object": "https://chatty.example/ben/p/51086"}
      </pre>

      <p>
        彼女はこのメッセージを自身の outbox に POST します
        （これは activity なため、彼女のサーバーはこれを Create オブジェクトの中に包む必要がないことを知っています）。
      </p>

      <p>
        嬉しさを感じたので、彼女はフォロワーに対して public なメッセージを投稿することを決めました。
        やがて、次のメッセージが彼女のフォロワーの collection のすべてのメンバーに送信されました。また、特別な Public group が指定されていたので、誰からでも一般に読むことが可能になっています。
      </p>

      <pre class="example highlight json">
  {"@context": "https://www.w3.org/ns/activitystreams",
   "type": "Create",
   "id": "https://social.example/alyssa/posts/9282e9cc-14d0-42b3-a758-d6aeca6c876b",
   "to": ["https://social.example/alyssa/followers/",
          "https://www.w3.org/ns/activitystreams#Public"],
   "actor": "https://social.example/alyssa/",
   "object": {"type": "Note",
              "id": "https://social.example/alyssa/posts/d18c55d4-8a63-4181-9745-4e6cf7938fa1",
              "attributedTo": "https://social.example/alyssa/",
              "to": ["https://social.example/alyssa/followers/",
                     "https://www.w3.org/ns/activitystreams#Public"],
              "content": "友達に本を貸すのは良い。返してもらうことはより良いですね！(^_^)"}}
      </pre>

      <section id="social-web-working-group" inlist="" rel="schema:hasPart"
               resource="#social-web-working-group">
        <h3 property="schema:name">Social Web Working Group</h3>
        <div datatype="rdf:HTML" property="schema:description">
          <p>
            <a href="#Overview">ActivityPub</a> は Social Web Working Group によって作られた、いくつかの関連する仕様のうちの1つです。別の手法や補完的なプロトコルに興味のある実装者は [[Micropub]] と概要に関する書類 [[Social-Web-Protocols]] を参照してください。
          </p>
        </div>
      </section>
    </section>

    <section id="conformance">
      <section id="specification-profiles">
        <h2>仕様のプロフィール</h2>
        <p>
          この仕様書では、密接に関係・相互作用する 2 つのプロトコルを定義します：
        </p>
        <dl>
          <dt>クライアント-サーバー間のプロトコル、すなわち「ソーシャル API」</dt>
          <dd>
            このプロトコルは、ユーザーに<i>代わって</i>クライアントが動作することを可能にします。
            例えば、このプロトコルは、携帯電話のアプリケーションがユーザーの actor のソーシャルストリームと接するために利用されます。
          </dd>
          <dt>サーバー間のプロトコル、すなわち「連合プロトコル」</dt>
          <dd>
            このプロトコルは、別々のサーバー上の actor たちによる activity を分配し、それらを同一のソーシャルグラフの内に結びつけるために利用されます。
          </dd>
        </dl>
        <p>
          これらのプロトコルのうちどちらか一方を実装したら、もう片方をサポートするのにわずかな努力しか必要がないように ActivityPub の仕様は設計されています。
          しかしながら、依然としてサーバー側では片方のみしか実装しないこともあります。
          このことは次の3つの準拠クラスを与えます：
        </p>
        <dl>
          <dt>ActivityPub に準拠したクライアント</dt>
          <dd>
            この指定は、クライアント-サーバー間プロトコルのクライアントの部分すべての実装を持つものに当てはまります。
          </dd>
          <dt>ActivityPub に準拠したサーバー</dt>
          <dd>
            この指定は、クライアント-サーバー間プロトコルのサーバーの部分すべての実装を持つものに当てはまります。
          </dd>
          <dt>ActivityPub に準拠した連合済みサーバー</dt>
          <dd>
            この指定は、連合プロトコルのサーバーの部分すべての実装を持つものに当てはまります。
          </dd>
        </dl>
        <p>
          連合プロトコルの実装に仕様の一部が当てはまる場合にのみ、このように分類されて呼ばれます。
          また、必要条件が指定されているときはいつでも、（クライアント-サーバー間のプロトコルについては）それらがクライアントまたはサーバーに当てはまるかどうか、
          またはサーバー間のプロトコルの内で送受信を行うサーバーについて言及するかどうかで分類されて呼ばれます。
        </p>
      </section>
    </section>

    <section id="obj">
      <h2>オブジェクト</h2>
      <p>
        オブジェクトは、[[!ActivityStreams]] と ActivityPub を構成する基本的な概念です。
        オブジェクトは多くの場合 activity に包まれたり、collection の stream に含まれたりします。
        collection 自身もまたオブジェクトのサブクラスです。
        詳しくは、[[!Activity-Vocabulary]] のドキュメントの、特に
        <a href="https://www.w3.org/TR/activitystreams-vocabulary/#types">Core Classes</a>
        の章を参照してください。
        ActivityPub は、この語彙の対応関係に厳密に従っています。
      </p>
      <p>
        ActivityPub は、ActivityStreams が提供するものに加えて、いくつかの用語を定義します。
        これらの用語は
        <code>https://www.w3.org/ns/activitystreams</code>
        にある ActivityPub の
        <a href="http://www.w3.org/TR/json-ld/#the-context">JSON-LD context</a>
        で提供されています。
        実装者は自身のオブジェクトの定義の中に ActivityPub の context を含めるべきです。
        実装者は適切に追加の context を含めてもよいです。
      </p>
      <p>
        ActivityPub は
        <a href="https://www.w3.org/TR/activitystreams-core/#urls">
          ActivityStreams の URI / IRI の慣例</a>
        と同じものを共有しています。
      </p>
      <p>
        サーバーは、内容のスプーフィング攻撃を避けるために受け取った内容を検証すべきです
        （少なくとも、オブジェクトが元の場所で受信されたように見えることを確認するのと同じぐらい堅牢な処理を行うべきですが、
        署名の確認などの方法が利用できるとより良いでしょう）。
        検証のための特定の方法がこのドキュメントできちんと指定されている訳ではないですが、
        <a href="#security-considerations">セキュリティについての考慮事項</a>にある提案やグッドプラクティスには目を通してください。
      </p>
      <div class="informative">
        例として、もし example.com が次の activity を受け取ったとき
        <pre class="example">
         {
           "@context": "https://www.w3.org/ns/activitystreams",
           "type": "Like",
           "actor": "https://example.net/~mallory",
           "to": ["https://hatchat.example/sarah/",
                  "https://example.com/peeps/john/"],
           "object": {
             "@context": {"@language": "ja"},
             "id": "https://example.org/~alice/note/23",
             "type": "Note",
             "attributedTo": "https://example.org/~alice",
             "content": "わたしはヤギ"
           }
         }
        </pre>
        <code>id</code> の参照外しを行うことで、それが有効なオブジェクトとして存在していることと、
        オブジェクトを不正確に表現していないことの両方を確かめるべきです
        （この例では、Alice が投稿したと伝えられているオブジェクトは Mallory が勝手に作ったものかもしれない）。
      </div>
      <section id="obj-id">
        <h2>オブジェクトの識別子</h2>
        <p>
          [[!ActivityStreams]] のすべてのオブジェクトは、固有のグローバルな識別子を持つべきです。
          ActivityPub はこの要求を拡張しています。ActivityPub プロトコルによって分配されるすべてのオブジェクトは、それらが意図的に一時的なもの（チャットメッセージやゲームの通知などの、生存期間が短くて検索されることを意図していない activity）でない場合には、固有のグローバルな識別子を持たなければいけません。
          これらの識別子は、次の分類のうちどれか 1 つに入っていなければいけません。
        </p>
        <ol>
          <li>
            public に参照外しができる、HTTPS URI などの URI で、その一存が元のサーバーに属しているようなもの
            （公開されているコンテンツには HTTPS URI を使うべきです）。
          </li>
          <li>匿名のオブジェクト（親の context の一部となるもの）を示す、明示的に JSON の <code>null</code> オブジェクトが指定された ID</li>
        </ol>
        <p>
          識別子は、その activity が意図的に一時的なものでない場合には、サーバー間の伝達において送信される activity に与えられていなければなりません。
          しかしながら、クライアント-サーバー間の伝達においては、サーバーに対して <code>id</code> が指定されていないオブジェクトが outbox に送信された場合、そのサーバーはその actor の名前空間内でオブジェクトの ID を確保し、それを送信されたオブジェクトに付与すべきです。
        </p>
        <p>すべてのオブジェクトは次のプロパティを持ちます：</p>
        <dl>
          <dt>id</dt>
          <dd>
            オブジェクトの固有のグローバルな識別子（オブジェクトが一時的なものであれば、<code>id</code> を省いてもよい）。
          </dd>
          <dt>type</dt>
          <dd>
            オブジェクトの型。
          </dd>
        </dl>
      </section>

      <section id="retrieving-objects">
        <h2>オブジェクトの取得</h2>
        <p>
          HTTP の GET メソッドは、オブジェクトの <code>id</code> に対して参照外しがなされ、activity を取得できます。
          サーバーは [[!RFC7231]] で定められているように、HTTP コンテントネゴシエーションを利用してリクエストに対するレスポンスで返すデータの型を選択してもよいですが、<code>application/ld+json; profile="https://www.w3.org/ns/activitystreams"</code> に対するレスポンスでは ActivityStreams のオブジェクトの表現を渡さなければいけませんし、<code>application/activity+json</code> に対するレスポンスでも同様に ActivityStreams の表現を渡すべきです。
          クライアントは、activity を取得するためには <code>Accept</code> ヘッダーに
          <code>application/ld+json; profile="https://www.w3.org/ns/activitystreams"</code>
          というメディアタイプを指定しなければいけません。
        </p>
        <p>
          サーバーは、上記の要件に適合しないようなリクエストへのふるまい方を実装してもよいです
          （例えば、サーバーは追加でレガシーなプロトコルを実装したり、リソースの HTML および ActivityStreams における表現のために同一の URI を使ってもよい）。
        </p>
        <p>
          サーバーは <a href="#authorization"></a> で指定されているように認可を要求してもよく、独自の認可ルールを実装することも許されます。
          サーバーは、認可チェックを通らないようなリクエストについては、適切な HTTP エラーコードまたは 403 Forbidden エラーコードでオブジェクトの存在が秘密であるとみなした上で失敗させるべきです。
          非公開な対象の存在を明らかにしたくないと願う配信元のサーバーは、404 Not Found ステータスコードで応答してもよいです。
        </p>
      </section>

      <section id="source-property">
        <h2>source プロパティ</h2>
        <p>
          [[!Activity-Vocabulary]] で定められるすべてのプロパティに加えて、ActivityPub は <code>Object</code> に <code>source</code> プロパティを入れるという拡張を行っています。
          <code>source</code> プロパティは、<code>content</code> のマークアップの出所となる一種のソースを伝えたり、クライアントによる将来の編集を意図したものです。
          一般に、クライアントは <code>source</code> から <code>content</code> への変換を行い、その反対は行いません。
        </p>
        <p>
          <code>source</code> の値そのものは、<code>content</code> と <code>mediaType</code> フィールドを持つオブジェクトであり、これでソースの情報を提供します。
        </p>
        <pre class="example">
          {
            "@context": ["https://www.w3.org/ns/activitystreams",
                         {"@language": "ja"}],
            "type": "Note",
            "id": "http://postparty.example/p/2415",
            "content": "&lt;p&gt;イチゴが &lt;em&gt;本当に&lt;/em&gt; 好き！&lt;/p&gt;",
            "source": {
              "content": "イチゴが *本当に* 好き！",
              "mediaType": "text/markdown"}
          }
        </pre>
        <div class="note"
             title="クライアントが意味を解釈して mediaType を扱えないときにはどうする？">
          <p>
            一般には、ユーザーに彼らの投稿を編集させるときには、元々書いたときと同じソースのフォーマットで編集させるのが一番です。
            しかし、すべてのクライアントが確実にすべてのソースの種類に対する立派なインターフェイスを提供できる訳ではないし、クライアントは <code>source</code> から <code>content</code> への変換を行うことを期待されているので、いくつかのクライアントは他のクライアントが扱い方を知らないような media type を扱うようなことがあるでしょう。
            クライアントがソースを無視して <code>content</code> マークアップを編集できるような形で提供することは可能だとしても、将来の版ではより望ましかったオリジナルの <code>source</code> の形式を失ってしまうことを意味します。
            したがって、そのような挙動をするクライアントは、元のソースフォーマットは扱えずに無視されてしまうという旨の、最小限の目立ちすぎない警告を提供すべきです。
          </p>
          <p>
            例えば、Alyssa P. Hacker は、彼女が書いた Emacs クライアントを使って、<a href="http://orgmode.org/">Org mode</a> を活用して自分の ActivityPub 搭載ブログに投稿するのが好きです。
            後に、彼女は携帯電話のクライアントで編集を行おうとしましたが、そこでは <code>text/x-org</code> が解釈されず、クライアントはそれを HTML に書き出す方法も知らないので、元の <code>content</code> を編集するためのテキストボックスを表示しました。
            編集エリアの上には、
            「この投稿は元々、このクライアントで扱う方法が不明なマークアップ言語で記述されています。編集すると、元のソースを失います！」
            という有益な警告が表示されました。
            Alyssa は、ただの typo の修正はすばらしい org-mode のマークアップを失うほど価値がある訳ではないと考え、家に帰ってから更新することにしました。
          </p>
        </div>
      </section>
    </section>

    <section id="actors">
      <h2>Actors</h2>
      <p>
        ActivityPub の actor は一般的に
        <a href="https://www.w3.org/TR/activitystreams-vocabulary/#actor-types">
          ActivityStreams の Actor の型</a> のうちのどれかに当てはまりますが、必ずしもそうである必要はありません。
        例えば、
        <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-profile">
          Profile</a> オブジェクトが actor として使われるかもしれないし、ActivityStreams の拡張からの型が使われるかもしれません。
          Actor は ActivityPub の他のオブジェクトのように<a href="#retrieving-objects">取得</a>されます。
          他の ActivityStreams のオブジェクトのように、actor は、URI である <code>id</code> を持ちます。
          ユーザーインターフェースにそのまま入力される場合（例としてログインフォームなど）には、簡単化された名前をサポートすることが望ましいです。
          この目的のため、ID の正規化は次のように行なわれるべきです。
      </p>
      <ol>
        <li>
          入力された ID が正当な URI であったならば、それを直接利用する。
        </li>
        <li>
          ユーザーが URI にスキーマを入れ忘れていること以外は正当な URI となる場合（<code>example.org/alice/</code> など）、クライアントはスキーマの既定値を提供することができる。好ましいのは <code>https</code> である。
        </li>
        <li>
          それ以外の場合は、入力された値は不正であるとすべきである。
        </li>
      </ol>

      <p>
        actor の URI が識別されたならば、参照外しが行われるべきです。
      </p>

      <div class="note">
        ActivityPub は「ユーザー」と actor の関係を具体的に要求しません。様々な構成が可能です。
        ある一つの actor を操る複数の人間や組織がいるかもしれないし、一人の人間や組織が複数の actor を操るかもしれません。
        同様に、actor はボットや自動化された処理などのソフトウェアの一部を表現することもできます。
        同一の実態によってコントロールされる actor を結びつけることや、一つの actor を複数のプロフィールや側面を通して表現するような、より詳細な「ユーザー」のモデル化については、実装側の裁量によります。
      </div>

      <section id="actor-objects">
        <h2><i>Actor</i> オブジェクト</h2>
        <p>
          Actor オブジェクトは <a href="#obj-id"></a> で義務付けられたプロパティに加えて、次のプロパティを持たなければなりません。
        </p>
        <dl>
          <dt id="inbox-property">inbox</dt>
          <dd>
            actor が受け取ったすべてのメッセージを含むような [[!ActivityStreams]] の
            <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
              <code>OrderedCollection</code></a> への参照。詳細は <a href="#inbox"></a>
          </dd>
          <dt id="outbox-property">outbox</dt>
          <dd>
            actor が生み出したすべてのメッセージを含むような [[!ActivityStreams]] の
            <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
              <code>OrderedCollection</code></a> への参照。詳細は <a href="#outbox"></a>
          </dd>
        </dl>
        <p>
          実装は、これに加えて次のプロパティを提供すべきです。
        </p>
        <dl>
          <dt id="following-property">following</dt>
          <dd>
            この actor がフォローしている actor で構成される [[!ActivityStreams]] の collection へのリンク。詳細は <a href="#following"></a>
          </dd>
          <dt id="followers-property">followers</dt>
          <dd>
            この actor をフォローしている actor で構成される [[!ActivityStreams]] の collection へのリンク。詳細は <a href="#followers"></a>
          </dd>
        </dl>
        <p>
          実装は次のプロパティを提供してもよいです。
        </p>
        <dl>
          <dt id="liked-property">liked</dt>
          <dd>
            この actor が like したオブジェクトで構成される [[!ActivityStreams]] の collection へのリンク。詳細は <a href="#liked"></a>
          </dd>
        </dl>
        <pre class="example">
{
  "@context": ["https://www.w3.org/ns/activitystreams",
               {"@language": "ja"}],
  "type": "Person",
  "id": "https://kenzoishii.example.com/",
  "following": "https://kenzoishii.example.com/following.json",
  "followers": "https://kenzoishii.example.com/followers.json",
  "liked": "https://kenzoishii.example.com/liked.json",
  "inbox": "https://kenzoishii.example.com/inbox.json",
  "outbox": "https://kenzoishii.example.com/feed.json",
  "preferredUsername": "kenzoishii",
  "name": "石井健蔵",
  "summary": "この方はただの例です",
  "icon": [
    "https://kenzoishii.example.com/image/165987aklre4"
  ]
}
        </pre>
        <p>実装は、これに加えて次のプロパティを提供してもよいです。</p>
        <dl>
          <dt id="streams-property">streams</dt>
          <dd>
            関心があるかもしれない補足的な collection のリスト。
          </dd>
          <dt id="preferredUsername">preferredUsername</dt>
          <dd>
            固有性の保障はないが、actor へ言及するときに使える短いユーザーネーム。
          </dd>
          <dt id="endpoints">endpoints</dt>
          <dd>
            この actor や、この actor を参照する人にとって助けとなるかもしれない、追加の（典型的にはサーバー・ドメイン規模の）エンドポイントを表す JSON オブジェクト。
            これは actor を表すドキュメントの中で値として含むこともできるし、これらのプロパティを含む JSON-LD ドキュメントへのリンクとすることもできる。
          </dd>
        </dl>

        <p>
          <code>endpoints</code> は、次のプロパティを含んでもよいです。
        </p>
        <dl>
          <dt id="proxyUrl">proxyUrl</dt>
          <dd>
            actor のクライアントがこのエンドポイント URI によって、アクセスに認証を必要とする外部の ActivityStreams のオブジェクトにアクセスできるようになります。
            このエンドポイントを使うには、クライアントは
            <code>x-www-form-urlencoded</code> な <code>id</code> パラメータに、要求する ActivityStreams オブジェクトの <code>id</code> を設定して POST します。
          </dd>
          <dt id="oauthAuthorizationEndpoint">oauthAuthorizationEndpoint</dt>
          <dd>
            OAuth 2.0 bearer tokens [[RFC6749]] [[RFC6750]] が<a href="#client-to-server-interactions">クライアント-サーバー間のやりとり</a>の認証で使われているとき、このエンドポイントはブラウザで認証されたユーザーに新しく認可の許可を与えるための URI を指定します。
          </dd>
          <dt id="oauthTokenEndpoint">oauthTokenEndpoint</dt>
          <dd>
            OAuth 2.0 bearer tokens [[RFC6749]] [[RFC6750]] が<a href="#client-to-server-interactions">クライアント-サーバー間のやりとり</a>の認証で使われているとき、このエンドポイントはクライアントがアクセストークンを取得するための URI を指定します。
          </dd>
          <dt id="provideClientKey">provideClientKey</dt>
          <dd>
            Linked Data 署名と HTTP 署名が認証および認可に使われているとき、このエンドポイントはブラウザで認証されたユーザーが<a href="#client-to-server-interactions">クライアント-サーバー間のやりとり</a>のためのクライアントの公開鍵を認可するための URI を指定します。
          </dd>
          <dt id="signClientKey">signClientKey</dt>
          <dd>
            Linked Data 署名と HTTP 署名が認証および認可に使われているとき、このエンドポイントはクライアントが actor の代わりに外部のサーバーとやりとりするために、クライアントの鍵を actor の鍵によってある一定期間だけ署名するための URI を指定します。
          </dd>
          <dt id="sharedInbox">sharedInbox</dt>
          <dd>
            <a href="#shared-inbox-delivery">公開された activity や、フォロワーに送信される activity を幅広く配信するために使われる</a>任意のエンドポイント。
            <code>sharedInbox</code> エンドポイントは特殊な <a href="#public-addressing">Public</a> collection 宛てのオブジェクトを含む、誰でも読める <code>OrderedCollection</code> オブジェクトでもあるべきです。
            <code>sharedInbox</code> エンドポイントから読まれるオブジェクトとして <code>Public</code> エンドポイント宛てでないようなものは提供してはいけません。
          </dd>
        </dl>

        <div class="note" id="as2-actor-properties">
          <p>
            ActivityPub の上流の語彙として、ActivityPub の actor には適切な [[!ActivityStreams]] のプロパティを使うことができます。
            いくつかの ActivityStreams のプロパティは特にハイライトする価値があります。それらがどのように ActivityPub の実装で使われるか見てみましょう。
          </p>

          <dl>
            <dt id="url-property">url</dt>
            <dd>
              <code>id</code> の値と等しくなければ、actor の「プロフィールの Web ページ」へのリンクを表す。
            </dd>
            <dt id="name-property">name</dt>
            <dd>
              actor が望む「ニックネーム」および「ディスプレイネーム」を表す。
            </dd>
            <dt id="summary-property">summary</dt>
            <dd>ユーザーによる簡素な概要や自己紹介文。</dd>
            <dt id="icon-property">icon</dt>
            <dd>
              ユーザーのプロフィール画像を表現する画像へのリンクまたは Image オブジェクト（サムネイルであっても良い）。
            </dd>
          </dl>
        </div>
        <p class="note" id="actor-text-direction">
          <code>name</code>, <code>preferredUsername</code>, <code>summary</code> のような自然言語の値を含むプロパティは、<a href="https://www.w3.org/TR/activitystreams-core/#naturalLanguageValues">ActivityStreams で定義される自然言語のサポート</a>を活用できます。
        </p>
      </section>

    </section>

    <section id="collections">
      <h2>Collections</h2>
      <p>
        [[!ActivityStreams]] は collection の概念を定義しますが、ActivityPub は特殊なふるまいをする collection をいくつか定義します。
        ActivityPub はオブジェクトを集めた大きな集合を走査するために
        <a href="https://www.w3.org/TR/activitystreams-core/#paging">
          ActivityStreams のページング</a>を活用していることに注意してください。
      </p>

      <p>
        これらのいくつかの collection は、具体的には
        <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
          <code>OrderedCollection</code></a> の型を持つように指定されていることもあれば、他のものは
        <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-collection">
          <code>Collection</code></a>
        または
        <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
          <code>OrderedCollection</code></a>
        となることが許されていることもあることに注意してください。
        <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
          <code>OrderedCollection</code></a> は、一貫して逆の年代順で（訳注：時間的な流れをさかのぼって）表現されていなければいけません。
      </p>

      <p class="note">
        逆の年代順を決定するために仕様されるプロパティは実装詳細として意図的に残されています。例えば、多くの SQL スタイルのデータベースはインクリメントされていく整数を識別子として使用します。これは、ほとんどの場合で挿入された順序を扱うときには合理的に使用できます。
        他のデータベースでは、挿入された時間のタイムスタンプが優先されることがあります。何を使用するかは重要ではないですが、要素の順序は、新しいものが最初に来るということと共にそのままでなければいけません。定期的に変更される「最後の更新日時」のようなタイムスタンプは使用されるべきではありません。
      </p>

      <section id="outbox">
        <h2>Outbox</h2>
        <p>
          outbox は、<a href="#actors">actor</a> のプロフィールにある <code>outbox</code> から見つけることができます。
          <code>outbox</code> は <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
            <code>OrderedCollection</code></a> でなければいけません。
        </p>
        <p>
          outbox ストリームはユーザーが公開した activity を含んでおり、要求者が activity を受け取れるような機能を提供します（つまり、outbox のコンテンツは読む人の権限によってフィルタリングされます）。
          ユーザーが<a href="#authorization">認可</a>なしにリクエストを送信した場合、サーバーはすべての <a href="#public-addressing">Public</a> な投稿で応答する必要があります。
          これは、ユーザーによって公開されたすべての関連するオブジェクトとなる可能性がありますが、利用可能なアイテムはサーバーを実装およびデプロイする側の裁量に任されています。
        </p>
        <p>
          outbox は<a href="#client-to-server-interactions">クライアント-サーバー間のやりとり</a>にて述べられているふるまいと共に HTTP POST リクエストを受け付けます。
        </p>
      </section>

      <section id="inbox">
        <h2>Inbox</h2>

        <p>
          inbox は、<a href="#actors">actor</a> のプロフィールにある <code>inbox</code> から見つけることができます。
          <code>inbox</code> は <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
            <code>OrderedCollection</code></a> でなければいけません。
        </p>

        <p>
          inbox ストリームはユーザーが受け取った activity を含んでいます。
          サーバーは、要求者の権限に応じてコンテンツをフィルタリングする必要があります。
          一般的に、inbox のオーナーはおそらく彼らの inbox のすべてのコンテンツにアクセスできるでしょう。
          アクセスコントロールに応じて、あるコンテンツは公開されている場合がありますが、オーナーでないユーザーが inbox にアクセスできる場合は、他のコンテンツについては認証を要求する場合もあります。
        </p>

        <p>
          サーバーは inbox によって返される activity の重複を除去しなければいけません。ある activity が actor のフォロワーと、受信者となる actor をフォローしている actor を宛先としているときに、サーバーが受信者リストの重複除去に失敗すると重複が発生してしまいます。
          そのような重複除去は、activity の <code>id</code> を比較して、すでに見た activity を落とすことで行なわれなければいけません。
        </p>

        <p>
          連合しているサーバー上の actor の inbox は<a href="#delivery">配送</a>にて述べられているふるまいと共に HTTP POST リクエストを受け付けます。
          連合していないサーバーは、POST リクエストの受信に対して 405 Method Not Allowed を返すべきです。
        </p>
      </section>

      <section id="followers">
        <h2>Followers Collection</h2>
        <p>
          すべての <a href="#actors">actor</a> は <code>followers</code> collection を持つべきです。
          これは、
          <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-follow">Follow</a>
          activity を actor に送ったすべての人のリストで、<a href="#follow-activity-outbox">副作用</a>として追加されます。
          これは、この actor をフォローしているすべての actor のリストです。
          <code>followers</code> collection は、
          <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
            <code>OrderedCollection</code></a>
          または
          <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-collection">
            <code>Collection</code></a>
          でなければならず、認証されたユーザーの特権に基いたり、認証情報が与えられていないときには適切にフィルタリングされてもよいです。
        </p>

        <p class="note" title="通知先の既定値">
          Follow activity は、一般には、ある actor が作るオブジェクトを見るためのリクエストです。
          これにより、Followers collection は、通知の<a href="#delivery">配送</a>を行うときの適切な既定値になります。
        </p>
      </section>

      <section id="following">
        <h2>Following Collection</h2>
        <p>
          すべての actor は <code>following</code> collection を持つべきです。
          これはその actor がフォローしたすべての人のリストであり、<a href="#follow-activity-outbox">副作用</a>として追加されるものです。
          <code>following</code> collection は、
          <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
            <code>OrderedCollection</code></a>
          または
          <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-collection">
            <code>Collection</code></a>
          でなければならず、認証されたユーザーの特権に基いたり、認証情報が与えられていないときには適切にフィルタリングされてもよいです。
        </p>
      </section>

      <section id="liked">
        <h2>Liked Collection</h2>
        <p>
          すべての actor は <code>liked</code> collection を持ってもよいです。
          これはその actor のすべての <code>Like</code> activity のすべてのオブジェクトのリストであり、<a href="#follow-activity-outbox">副作用</a>として追加されるものです。
          <code>liked</code> collection は、
          <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
            <code>OrderedCollection</code></a>
          または
          <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-collection">
            <code>Collection</code></a>
          でなければならず、認証されたユーザーの特権に基いたり、認証情報が与えられていないときには適切にフィルタリングされてもよいです。
        </p>
      </section>

      <section id="public-addressing">
        <h2>Public Addressing</h2>
        <p>
          [[!ActivityStreams]] の collection やオブジェクトに加えて、activity は
          <code>https://www.w3.org/ns/activitystreams#Public</code>
          という識別子を使って特別な "public" の collection に宛てることができます。
          例えば：
        </p>
        <pre class="example">
          {
            "@context": "https://www.w3.org/ns/activitystreams",
            "id": "https://www.w3.org/ns/activitystreams#Public",
            "type": "Collection"
          }
        </pre>
        <p>
          この特殊な URI に宛てられた activity は、すべてのユーザーが認証なしでアクセスできるとよいでしょう。
          実装は "public" の特殊な collection に向けて配送してはいけません。
          それは実際の activity を受信する機能を持っていません。
          しかしながら、actor は、公開投稿やフォロワー限定の投稿の、効率的な共同の配送のための
          <a href="#sharedInbox"><code>sharedInbox</code></a>
          エンドポイントを持ってもよいです（フォロワー限定の投稿も同様）。
          詳細は<a href="#shared-inbox-delivery"></a>を参照してください。
        </p>
        <div class="note">
          <p>
            ActivityStreams の JSON-LD context を使って ActivityStreams のオブジェクトをコンパクト化すると、
            <code>https://www.w3.org/ns/activitystreams#Public</code>
            が <code>Public</code> または <code>as:Public</code> のように簡単に表現されることがあります。これらは、Public collection の正当な表現です。
            JSON-LD のやり方で入ってくる activity をローカルのコンテキストに変換せず、単に JSON として ActivityStreams のオブジェクトを扱うような実装については、これに注意し、これらの3つの表現をすべて受け入れられるように準備しておくべきです。
          </p>
        </div>
      </section>

      <section id="likes">
        <h2>Likes Collection</h2>
        <p>
          すべてのオブジェクトは <code>likes</code> collection を持ってもよいです。
          これは、<code>object</code> プロパティとしてこのオブジェクトが付いていたすべての
          <code>Like</code> activity のリストで、<a href="#like-activity-inbox">副作用</a>として追加されます。
          <code>likes</code> collection は、
          <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
            <code>OrderedCollection</code></a>
          または
          <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-collection">
            <code>Collection</code></a>
          でなければならず、認証されたユーザーの特権に基いたり、認証情報が与えられていないときには適切にフィルタリングされてもよいです。
        </p>


        <div class="note">
          <p>
            <a href="#likes"><code>likes</code></a> collection と、名前が似ているが異なる
            <a href="#liked"><code>liked</code></a> collection を混同しないように気をつけましょう。
            要約すると：
          </p>

          <ul>
            <li>
              <b>liked:</b>
              具体的には、actor のプロパティである。
              これは、<i>その actor によって</i>行なわれた <code>Like</code> activity の collection であり、
              <a href="#like-activity-outbox">outbox への配達の副作用</a>として collection に追加されます。
            </li>

            <li>
              <b>likes:</b>
              任意のオブジェクトのプロパティとなり得る。
              これは、このオブジェクトを参照している <code>Like</code> activity の collection であり、
              <a href="#like-activity-inbox">inbox への配達の副作用</a>として collection に追加されます。
            </li>
          </ul>
        </div>
      </section>

      <section id="shares">
        <h2>Shares Collection</h2>
        <p>
          すべてのオブジェクトは <code>shares</code> collection を持ってもよいです。
          これは、<code>object</code> プロパティとしてこのオブジェクトが付いていたすべての
          <code>Announce</code> activity のリストで、<a href="#announce-activity-inbox">副作用</a>として追加されます。
          <code>shares</code> collection は、
          <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-orderedcollection">
            <code>OrderedCollection</code></a>
          または
          <a href="https://www.w3.org/TR/activitystreams-vocabulary/#dfn-collection">
            <code>Collection</code></a>
          でなければならず、認証されたユーザーの特権に基いたり、認証情報が与えられていないときには適切にフィルタリングされてもよいです。
        </p>
      </section>
    </section>

    <section id="client-to-server-interactions">
      <h2>Client to Server Interactions</h2>
      <p>
        Activities as defined by [[!ActivityStreams]] are the core mechanism
        for creating, modifying and sharing content within the social graph.
      </p>

      <p>
        Client to server interaction takes place through clients posting
        Activities to an actor's <a href="#outbox">outbox</a>.
        To do this, clients MUST discover the URL of the actor's outbox from
	their <a href="#actor-objects">profile</a> and then MUST make an HTTP
        <code>POST</code> request to this URL with the Content-Type of
        <code>application/ld+json; profile="https://www.w3.org/ns/activitystreams"</code>.
        Servers MAY interpret a Content-Type or Accept header of
        <code>application/activity+json</code> as equivalent
        to <code>application/ld+json; profile="https://www.w3.org/ns/activitystreams"</code>
        for client-to-server interactions.
        The request MUST be authenticated with the credentials of the user to
        whom the outbox belongs.
        The body of the <code>POST</code> request MUST contain a single
        Activity (which MAY contain embedded objects), or a single non-Activity
        object which
        <a href="#object-without-create">will be wrapped in a Create activity
          by the server</a>.
      </p>
      <pre class="example" title="Submitting an Activity to the Outbox">
POST /outbox/ HTTP/1.1
Host: dustycloud.org
Authorization: Bearer XXXXXXXXXXX
Content-Type: application/ld+json; profile="https://www.w3.org/ns/activitystreams"

{
  "@context": ["https://www.w3.org/ns/activitystreams",
               {"@language": "en"}],
  "type": "Like",
  "actor": "https://dustycloud.org/chris/",
  "name": "Chris liked 'Minimal ActivityPub update client'",
  "object": "https://rhiaro.co.uk/2016/05/minimal-activitypub",
  "to": ["https://rhiaro.co.uk/#amy",
         "https://dustycloud.org/followers",
         "https://rhiaro.co.uk/followers/"],
  "cc": "https://e14n.com/evan"
}
      </pre>

      <p>
        If an Activity is submitted with a value in the <code>id</code>
        property, servers MUST ignore this and generate a new <code>id</code>
        for the Activity.
        Servers MUST return a <code>201 Created</code> HTTP code, and unless
        the activity is transient, MUST include the new <code>id</code> in the
        <code>Location</code> header.
      </p>
      <pre class="example" title="Outbox response to submitted Activity">
HTTP/1.1 201 Created
Location: https://dustycloud.org/likes/345
      </pre>

      <p id="remove-bto-bcc-before-delivery">
        The server MUST remove the <code>bto</code> and/or <code>bcc</code>
        properties, if they exist, from the ActivityStreams object before
        delivery, but MUST utilize the addressing originally stored
        on the <code>bto</code> / <code>bcc</code> properties for determining
        recipients in <a href="#delivery">delivery</a>.
      </p>

      <p>
        The server MUST then add this new Activity to the
        <a href="#outbox">outbox</a> collection.
        Depending on the type of Activity, servers may then be required to
        carry out further side effects.
        (However, there is no guarantee that time the Activity may appear in
        the outbox.
        The Activity might appear after a delay or disappear at any period).
        These are described per individual Activity below.
      </p>

      <p>
        Attempts to submit objects to servers not implementing client to server
        support SHOULD result in a <code>405 Method Not Allowed</code> response.
      </p>


      <p>
        HTTP caching mechanisms [[!RFC7234]] SHOULD be respected when
        appropriate, both in clients receiving responses from servers as well
        as servers sending responses to clients.
      </p>

      <section id="client-addressing">
        <h3>Client Addressing</h3>
          <p>
          <strong>Clients</strong> are responsible for addressing new Activities
          appropriately.
          To some extent, this is dependent upon the particular client
          implementation, but clients must be aware that the server will only
          forward new Activities to addressees in the <code>to</code>,
          <code>bto</code>, <code>cc</code>, <code>bcc</code>, and
          <code>audience</code> fields.
        </p>
        <p>
          The <a href="#followers">Followers Collection</a> and/or the
          <a href="#public-addressing">Public Collection</a> are good
          choices for the default addressing of new Activities.
        </p>
        <p>
          Clients SHOULD look at any objects attached to the new Activity via the
          <code>object</code>, <code>target</code>, <code>inReplyTo</code> and/or
          <code>tag</code> fields, retrieve <em>their</em> <code>actor</code> or
          <code>attributedTo</code> properties, and MAY also retrieve their addressing
          properties, and add these to the <code>to</code> or <code>cc</code>
          fields of the new Activity being created.
          Clients MAY recurse through attached objects, but if doing so, SHOULD
          set a limit for this recursion.
          (Note that this does not suggest that the client should "unpack"
          collections of actors being addressed as individual recipients).
        </p>
        <p>
          Clients MAY give the user the chance to amend this addressing in the
          UI.
        </p>
        <p>
          For example, when Chris likes the following article by Amy:
        </p>

        <pre class="example" title="An Article">
  {
    "@context": ["https://www.w3.org/ns/activitystreams",
                 {"@language": "en-GB"}],
    "id": "https://rhiaro.co.uk/2016/05/minimal-activitypub",
    "type": "Article",
    "name": "Minimal ActivityPub update client",
    "content": "Today I finished morph, a client for posting ActivityStreams2...",
    "attributedTo": "<strong>https://rhiaro.co.uk/#amy</strong>",
    "to": "<strong>https://rhiaro.co.uk/followers/</strong>",
    "cc": "<strong>https://e14n.com/evan</strong>"
  }
        </pre>

        <p>the like is generated by the client as:</p>

        <pre class="example" title="A Like of the Article">
  {
    "@context": ["https://www.w3.org/ns/activitystreams",
                 {"@language": "en"}],
    "type": "Like",
    "actor": "https://dustycloud.org/chris/",
    "summary": "Chris liked 'Minimal ActivityPub update client'",
    "object": "https://rhiaro.co.uk/2016/05/minimal-activitypub",
    "to": ["<strong>https://rhiaro.co.uk/#amy</strong>",
           "https://dustycloud.org/followers",
           "<strong>https://rhiaro.co.uk/followers/</strong>"],
    "cc": "<strong>https://e14n.com/evan</strong>"
  }
        </pre>

        <p>The receiving outbox can then perform <a href="#delivery">delivery</a>
        to not only the followers of Chris (the liker), but also to Amy, and Amy's
        followers and Evan, both of whom received the original article.</p>

        <p>
          Clients submitting the following activities to an <code>outbox</code>
          MUST provide the <code>object</code> property in the activity:
          <code>Create</code>, <code>Update</code>, <code>Delete</code>,
          <code>Follow</code>, <code>Add</code>, <code>Remove</code>,
          <code>Like</code>, <code>Block</code>, <code>Undo</code>.
          Additionally, clients submitting the following activities to an outbox
          MUST also provide the <code>target</code> property:
          <code>Add</code>, <code>Remove</code>.
        </p>

      </section>


      <section id="create-activity-outbox">
        <h3>Create Activity</h3>
        <p>
          The <code>Create</code> activity is used when posting a new object.
          This has the side effect that the object embedded within the Activity
          (in the <code>object</code> property) is created.
        </p>
        <p>
          When a <code>Create</code> activity is posted, the <code>actor</code>
          of the activity SHOULD be copied onto the <code>object</code>'s
          <code>attributedTo</code> field.
        </p>
        <p>
          A mismatch between addressing of the Create activity and its
          <code>object</code> is likely to lead to confusion.
          As such, a server SHOULD copy any recipients of the Create activity
          to its <code>object</code> upon initial distribution, and likewise
          with copying recipients from the <code>object</code> to the wrapping
          Create activity.
          Note that it is acceptable for the <code>object</code>'s addressing
          to be changed later without changing the <code>Create</code>'s
          addressing (for example via an <code>Update</code> activity).
        </p>

        <section id="object-without-create">
        <h4>Object creation without a Create Activity</h4>
        <p>
          For client to server posting, it is possible to submit an object for
          creation without a surrounding activity.
          The server MUST accept a valid [[!ActivityStreams]] object that
          isn't a subtype of <code>Activity</code> in the POST request to the
          outbox.
          The server then MUST attach this object as the <code>object</code>
          of a <a href="#create-activity-outbox">Create Activity</a>.
          For non-transient objects, the server MUST attach an
          <code>id</code> to both the wrapping <code>Create</code> and its
          wrapped <code>Object</code>.
        </p>

        <p class="note">
          The <code>Location</code> value returned by the server should be the URL of
          the new Create activity (rather than the object).
        </p>

        <p>
          Any <code>to</code>, <code>bto</code>, <code>cc</code>, <code>bcc</code>,
          and <code>audience</code> properties specified on the object MUST be
          copied over to the new Create activity by the server.
        </p>

        <pre class="example" title="Object with audience targeting">
        {
          "@context": "https://www.w3.org/ns/activitystreams",
          "type": "Note",
          "content": "This is a note",
          "published": "2015-02-10T15:04:55Z",
          "to": ["https://example.org/~john/"],
          "cc": ["https://example.com/~erik/followers",
                 "https://www.w3.org/ns/activitystreams#Public"]
        }
        </pre>

        The above example could be converted to this:
        <pre class="example" title="Create Activity wrapper generated by the server">
        {
          "@context": "https://www.w3.org/ns/activitystreams",
          "type": "Create",
          "id": "https://example.net/~mallory/87374",
          "actor": "https://example.net/~mallory",
          "object": {
            "id": "https://example.com/~mallory/note/72",
            "type": "Note",
            "attributedTo": "https://example.net/~mallory",
            "content": "This is a note",
            "published": "2015-02-10T15:04:55Z",
            "to": ["https://example.org/~john/"],
            "cc": ["https://example.com/~erik/followers",
                   "https://www.w3.org/ns/activitystreams#Public"]
          },
          "published": "2015-02-10T15:04:55Z",
          "to": ["https://example.org/~john/"],
          "cc": ["https://example.com/~erik/followers",
                 "https://www.w3.org/ns/activitystreams#Public"]
        }
        </pre>
        </section>
      </section>
      <section id="update-activity-outbox">
        <h3>Update Activity</h3>
        <p>
          The <code>Update</code> activity is used when updating an already
          existing object.
          The side effect of this is that the <code>object</code> MUST be
          modified to reflect the new structure as defined in the update
          activity, assuming the actor has permission to update this
          object.
        </p>

        <section id="partial-updates">
          <h4>Partial Updates</h4>
          <p>
            For client to server interactions, updates are partial;
            rather than updating the document all at once, any key value
            pair supplied is used to replace the existing value with
            the new value.
            This only applies to the top-level fields of the updated
            object.
            A special exception is for when the value is the json
            <code>null</code> type; this means that this field should be
            removed from the server's representation of the object.
          </p>
          <p>
            Note that this behavior is for client to server interaction where
            the client is posting to the server only.
            Server to server interaction and updates from the server to the client
            should contain the entire new representation of the object, after
            the partial update application has been applied.
            See the description of the
            <a href="#update-activity-inbox">Update activity for server to server
              interactions</a>
            for more details.
          </p>
        </section>
      </section>
      <section id="delete-activity-outbox">
        <h3>Delete Activity</h3>
        <p>
          The <code>Delete</code> activity is used to delete an already
          existing object.
          The side effect of this is that the server MAY replace the
          <code>object</code> with a <code>Tombstone</code> of the object
          that will be displayed in activities which reference the deleted
          object.
          If the deleted object is requested the server SHOULD respond with
          either the HTTP 410 Gone status code if a <code>Tombstone</code>
          object is presented as the response body, otherwise respond with a
          HTTP 404 Not Found.
        </p>

        <p>A deleted object:</p>
        <pre class="example">
          {
            "@context": "https://www.w3.org/ns/activitystreams",
            "id": "https://example.com/~alice/note/72",
            "type": "Tombstone",
            "published": "2015-02-10T15:04:55Z",
            "updated": "2015-02-10T15:04:55Z",
            "deleted": "2015-02-10T15:04:55Z"
          }
        </pre>
      </section>
      <section id="follow-activity-outbox">
        <h3>Follow Activity</h3>
        <p>
          The <code>Follow</code> activity is used to subscribe to the
          activities of another actor.
        </p>
        <p>
          The side effect of receiving this in an <strong>outbox</strong>
          is that the server SHOULD add the <code>object</code> to the
          <code>actor</code>'s <a href="#following"><code>following</code> Collection</a>
          when and only if an <code>Accept</code> activity is subsequently
          received with this <code>Follow</code> activity as its object.
        </p>
      </section>
      <section id="add-activity-outbox">
        <h3>Add Activity</h3>
        <p>
          Upon receipt of an <code>Add</code> activity into the
          <strong>outbox</strong>, the server SHOULD
          add the <code>object</code> to the collection specified in the
          <code>target</code> property, unless:
        </p>
        <ul>
          <li>
            the <code>target</code> is not owned by the receiving
            server, and thus they are not authorized to update it.
          </li>
          <li>
            the <code>object</code> is not allowed to be added to the
            <code>target</code> collection for some other reason, at the
            receiving server's discretion.
          </li>
        </ul>
      </section>
      <section id="remove-activity-outbox">
        <h3>Remove Activity</h3>
        <p>
          Upon receipt of a <code>Remove</code> activity into the
          <strong>outbox</strong>, the server SHOULD
          remove the <code>object</code> from the collection specified in the
          <code>target</code> property, unless:
        <ul>
          <li>
            the <code>target</code> is not owned by the receiving server, and
            thus they are not authorized to update it.
          </li>
          <li>
            the <code>object</code> is not allowed to be removed from the
            <code>target</code> collection for some other reason, at the
            receiving server's discretion.
          </li>
        </ul>
      </section>
      <section id="like-activity-outbox">
        <h3>Like Activity</h3>
        <p>
          The <code>Like</code> activity indicates the <code>actor</code> likes
          the <code>object</code>.
        </p>
        <p>
          The side effect of receiving this in an <strong>outbox</strong>
          is that the server SHOULD add the <code>object</code> to the
          <code>actor</code>'s <a href="#liked"><code>liked</code> Collection</a>.
        </p>
      </section>
      <section id="block-activity-outbox">
        <h3>Block Activity</h3>
        <p>
          The <code>Block</code> activity is used to indicate that the posting
          actor does not want another actor (defined in the <code>object</code>
          property) to be able to interact with objects posted by the actor
          posting the <code>Block</code> activity.
          The server SHOULD prevent the blocked user from interacting with any object
          posted by the actor.
        </p>
        <p>
          Servers SHOULD NOT deliver Block Activities to their <code>object</code>.
        </p>
      </section>
      <section id="undo-activity-outbox">
        <h3>Undo Activity</h3>
        <p>
          The <code>Undo</code> activity is used to undo a previous activity.
          See the Activity Vocabulary documentation on
          <a href="https://www.w3.org/TR/activitystreams-vocabulary/#inverse">
            Inverse Activities and "Undo"</a>.
          For example, <code>Undo</code> may be used to undo a previous
          <code>Like</code>, <code>Follow</code>, or <code>Block</code>.
          The undo activity and the activity being undone MUST both have the
          same actor.
          Side effects should be undone, to the extent possible.
          For example, if undoing a <code>Like</code>, any counter that had
          been incremented previously should be decremented appropriately.
        </p>

        <p>
          There are some exceptions where there is an existing and explicit
          "inverse activity" which should be used instead.
          <code>Create</code> based activities should instead use
          <code>Delete</code>, and <code>Add</code> activities should use
          <code>Remove</code>.
        </p>
      </section>

      <section id="client-to-server-outbox-delivery">
        <h3>Delivery</h3>
        <p>
          Federated servers MUST perform delivery on all Activities posted to the
          <strong>outbox</strong> according to <a href="#outbox-delivery">
          outbox delivery</a>.
        </p>
      </section>

      <section id="uploading-media" class="informative">
        <h2>Uploading Media</h2>
        <p>
          Servers MAY support uploading document types to be referenced in
          activites, such as images, video or other binary data, but the
          precise mechanism is out of scope for this version of ActivityPub.
          The Social Web Community Group is refining the protocol in the
          <a href="https://www.w3.org/wiki/SocialCG/ActivityPub/MediaUpload">ActivityPub Media Upload report</a>.
        </p>
      </section>


    </section>

    <section id="server-to-server-interactions">
      <h2>サーバー間の振る舞い</h2>
      <p>
        サーバーは、actor の <a href="#inbox">inbox</a> のエンドポイントに activity を post することでソーシャルグラフを介した情報の伝達を他のサーバーと行います。
        ネットワーク越しに送信された activity は、それが一時的なものであると意図したものでない限りは <code>id</code> を持つべきです（一時的なものであるときは <code>id</code> を省略することができます）。
      <p>
        （inbox に向けたもの等の）<code>POST</code> リクエストは Content-Type に <code>application/ld+json; profile="https://www.w3.org/ns/activitystreams"</code> を設定した上で作成しなければいけません。また、<code>GET</code> リクエストは Accept ヘッダに <code>application/ld+json; profile="https://www.w3.org/ns/activitystreams"</code> を設定した上で作成しなければいけません（<a href="#retrieving-objects"></a> も参照）。
        サーバーは、サーバー間の振る舞いの際に Content-Type や Accept ヘッダに <code>application/activity+json</code> が設定されていたならば、これを <code>application/ld+json; profile="https://www.w3.org/ns/activitystreams"</code> と同等のものとして解釈すべきです。
      </p>
      <p>
        ソーシャルグラフ全体を通して更新の伝搬を行うために、activity は適切な受信者に送信されます。
        最初に、これらの受信者は actor に到達するまでオブジェクト間の適切なリンクを辿ることで決定され、その後 activity が actor の <em>inbox</em> に挿入されます（<a href="#delivery">配送</a>）。
        これによって、受け取る側のサーバーは次のことができるようになります：
      </p>
      <ul>
        <li>
          その activity に関する任意の副作用を施す（例えば、ある actor がある object を like したという通知が、その object の like された回数を更新するために利用される）
        </li>
        <li>
          更新がソーシャルグラフ全体に伝搬したことを確実にするため、activity を元オブジェクトの受信者に配送する（<a href="#inbox-forwarding">inbox への配送</a>を参照）
        </li>
      </ul>
      <p>配送は通常、次のようなもので引き起こされます：</p>
      <ul>
        <li>
          actor の <a href="#outbox">outbox</a> で、受信者として <a href="#followers">Followers Collection</a> が指定された activity が作成された
        </li>
        <li>
          actor の <a href="#outbox">outbox</a> で、受信者が直接指定された activity が作成された
        </li>
        <li>
          actor の <a href="#outbox">outbox</a> で、受信者としてユーザーによって整理された collection たちが指定された activity が作成された
        </li>
        <li>
          actor の <a href="#outbox">outbox</a> または <a href="#inbox">inbox</a> で、他のオブジェクトを参照する activity が作成された
        </li>
      </ul>

      <p>
        他のサーバー上にある actor が持つ <code>inbox</code> または <code>sharedInbox</code> プロパティへの配送を実施するサーバーは、次の activity の中には <code>object</code> プロパティを含めなければなりません：
        <code>Create</code>, <code>Update</code>, <code>Delete</code>,
        <code>Follow</code>, <code>Add</code>, <code>Remove</code>,
        <code>Like</code>, <code>Block</code>, <code>Undo</code>。
        さらに、次の activity の配送をサーバー間で実施するサーバーは、<code>target</code> プロパティも含めなければなりません：<code>Add</code>, <code>Remove</code>。
      </p>

      <p>
        HTTP キャッシュ機構 [[!RFC7234]] は、他のサーバーからレスポンスを受け取る際や、他のサーバーへレスポンスを送信する際の両方において、適切な際に尊重されているべきです。
      </p>

      <section id="delivery">
        <h2>配送</h2>

        <p><i>
          以下のことは、他の連合サーバーと伝達を行う連合サーバーによってのみ要求されるものです。
        </i></p>

        <p>
          activity は、最初に対象たち（<a href="#actors">actors</a>）の inbox を探し、それらに対して投稿することによって、その対象たちに配送されます。
          配送の対象は <a href="https://www.w3.org/TR/activitystreams-vocabulary/#audienceTargeting">
            ActivityStreams audience targeting</a> を確認することによって決定されます。すなわち、activity の <code>to</code>, <code>bto</code>, <code>cc</code>, <code>bcc</code>, そして <code>audience</code> フィールドを確認すればよいです。
        </p>

        <p>
          <a href="#inbox">inbox</a> は、まず <a href="#retrieving-objects">JSON-LD で表現された対象の actor を受け取って</a>、それから <code>inbox</code> プロパティを探すことで確定されます。
          もし受信者が <code>Collection</code> または <code>OrderedCollection</code> であるならば、サーバーはその collection を（そのユーザーの資格情報と共に）展開し、collection 内のそれぞれの要素の inbox を見つけ出さなければいけません。
          サーバーは collection を通した間接参照の層の解消回数を制限しなければいけませんが、これは 1 でもよいです。
        </p>

        <p>
          サーバーは最終的な受信者の一覧から重複する要素を取り除かなければいけません。
          サーバーはまた、通知される activity の <code>actor</code> と同じ actor をリストから除去しなければいけません。
          すなわち、actor には自身の activity が配送されないはずであるということです。
        </p>

        <p class="note" title="Silent and private activities">
          受信者が指定されていないときにすることは未定義ですが、そのような場合には object を完全に非公開とし、アクセスコントロールがその object へのアクセスを制限することが推奨されます。
          もし、その object が単に "public" コレクションに送信されたならば、その object はどの actor にも配送されませんが、actor の outbox で公に閲覧可能になります。
        </p>

        <p>
          次に、その activity を body とした（投稿するユーザーの認可付きの）HTTP POST リクエストが <a href="#inbox">inbox</a> に行われます。
          この activity はレシーバによって <a href="#inbox">inbox</a> OrderedCollection の <code>item</code> として追加されます。
          連合していないサーバーによる inbox への配送の試みには <code>405 Method Not Allowed</code> レスポンスを返すべきです。
        </p>

        <p>
          第三者のサーバーへ配送を試みる連合サーバーについては、配送は非同期に実行されるべきであり、さらにネットワークエラーによって失敗した場合には配送を再試行すべきです。
        </p>

        <p>
          <strong>注意：</strong>同一オリジン上での actor 間の activity の分配には任意の内部的な機構を利用してもよく、HTTP を利用することは要求されません。
        </p>

        <p class="note" id="ldn-relationship" title="Relationship to Linked Data Notifications">
          この仕様を理解するために読むことは必須ではありませんが、ActivityPub のターゲティングと配送の機構は <a href="https://www.w3.org/TR/ldn/">Linked Data Notifications</a> の仕様と重なる部分があり、二つの仕様は相互運用的に組み合わせられることは特筆する価値があります。
          特に、<code>inbox</code> プロパティは ActivityPub と Linked Data Notifications の間で同一であり、このドキュメントで説明されているターゲティングと配送システムは Linked Data Notifications でサポートされています。
          JSON-LD で詰められた ActivityStreams の文書に加えて、Linked Data Notifications は ActivityPub の実装には必要のない数々の RDF シリアライズもサポートしています。
          しかしながら、Linked Data Notifications に対してより広範に互換性を持たせたい ActivityPub の実装では、他の RDF の表現に対応したほうがよいでしょう。
        </p>

        <section id="outbox-delivery">
          <h3>サーバー間の outbox への配送時の要件</h3>
          <p>
            （<a href="#client-to-server-interactions">クライアント─サーバー間の振る舞い</a>と<a href="#server-to-server-interactions">サーバー間の振る舞い</a>の両方をサポートしているサーバーについては）<a href="#outbox">outbox</a> で object を受け取ったとき、サーバーは次のものを対象にして配送しなければいけません：
          </p>
          <ul>
            <li>
              値が actor によって所有されている個人または collection である場合、<code>to</code>, <code>bto</code>, <code>cc</code>,
              <code>bcc</code> または <code>audience</code> フィールドのいずれか
            </li>
          </ul>
          <p>
            これらのフィールドは、activity を outbox に投稿した<a href="#client-addressing">クライアントによって適切に展開されている</a>ことになることでしょう。
          </p>
        </section>

        <section id="inbox-forwarding">
          <h3>inbox からの転送</h3>

          <div class="note" title="Forwarding to avoid the ghost replies problem">
            <p>
              次の章は、連合するネットワークの上でときどき問題を引き起こす「ゴーストリプライ」という問題を軽減するためのものです。
              この問題は一例と共に示すのがわかりやすいです。
            </p>

            <p>
              Alyssa は会議での論文の発表が上手くいったことを投稿し、友達の Ben を含むフォロワーの collection に送信しました。
              Ben は Alyssa のメッセージに対してお祝いのメッセージを送信し、そこには受信者として彼女のフォロワーの collection を含めました。
              しかしながら、Ben は Alyssa のフォロワーの collection のメンバーを見ることができないので、彼のサーバーは彼らの inbox にそのメッセージを転送できません。
              次の機構なしで、もし Alyssa が次に Ben へ返信したときには、彼女のフォロワーは Ben の対話を見ることなく Alyssa が Ben に返信しているのを見ることになります。これは大変混乱します！
            </p>
          </div>

          <p>
            <a href="#inbox">inbox</a> で activity たちを受け取ったとき、そのサーバーは送信元が配送できなかった受信者にそれらを転送する必要があります。これをするには、次の全てが真であるとき、かつそのときに限って、サーバーは <code>to</code>, <code>cc</code>, そして <code>audience</code> の値にターゲットして<a href="#delivery">配送</a>しなければいけません：
          </p>
          <ul>
            <li>サーバーはこの activity を見るのが初めてである。
            </li>
            <li>
              <code>to</code>, <code>cc</code>, そして <code>audience</code> の値はそのサーバーが所有している object である。
            </li>
            <li>
              <code>inReplyTo</code>, <code>object</code>,
              <code>target</code> そして <code>tag</code> の値はそのサーバーが所有している object である。
              サーバーは、自身が所有しているリンクされた object を探すためにこれらの値を再帰的に処理するべきであり、また再帰回数の上限を設定するべきです（すなわち、それほどスレッドが深くなった段階においては、受信者であるフォロワーは直接的に受信者を含まない更新を受け取らなくなっても気にしなくなるかもしれません）。
              サーバーは転送された元のオブジェクトの <code>to</code>, <code>cc</code>, そして <code>audience</code> の値のみをターゲットとし、リンクされた object を再帰的に処理しながらも新たな（意図的に変更されたり、クライアント経由で得られた）アドレスを拾わないようにしなければなりません。
            </li>
          </ul>
          <p>
            サーバーは配送ターゲットを実装依存の規則に基いてフィルターしてもよいです（例えば、スパムのフィルタリングなど）。
          </p>
        </section>

        <section id="shared-inbox-delivery">
          <h2>共有 inbox への配送</h2>
          <p>
            数多くの actor をホストしているサーバーによっては、すべてのフォロワーへの配送は圧倒的な数のメッセージを送信することにつながってしまいます。
            一部のサーバーはまた、公に対して投稿されたすべてのメッセージを「知り合いのネットワーク」として表示したいでしょう。
            そこで、ActivityPub はこれら二つのユースケースを扱うためのオプショナルな機構を提供します。
          </p>
          <p>
            配送元 actor のフォロワーに object が配送されるとき、サーバーは同じ <a href="#sharedInbox">sharedInbox</a> を持つすべてのフォロワーを識別することで、各々の受信者を指定するのではなく <code>sharedInbox</code> に指定されたところに object を配送することができ、これによって配送されたものを受け取る actor の数を減らしてもよいです。
            したがって、このシナリオでは、リモートまたは受信側のサーバーはターゲティングの決定および特定の inbox への配送の実行に携わることになります。
          </p>
          <p>
            さらに、もし object が <a href="#public-addressing">Public</a> という特別な collection に向けられたものであるならば、サーバーはネットワーク上のすべての既知の <code>sharedInbox</code> に配送してもよいです。
          </p>
          <p>
            公に向けられた activity を <code>sharedInbox</code> エンドポイントに送信する送信元サーバーは、（<code>to</code>, <code>bto</code>, <code>cc</code>, <code>bcc</code>, または <code>audience</code> を通して）向けられた、仮に <code>sharedInbox</code> を持っていればその機構を通して activity を受け取っていたが実際には <code>sharedInbox</code> を持たないような actor や collection にも、依然として配送しなければいけません。
          </p>
        </section>
      </section>

      <section id="create-activity-inbox">
        <h3>Create Activity</h3>
        <p>
          Receiving a <code>Create</code> activity in an <code>inbox</code> has
          surprisingly few side effects; the activity should appear in the
          actor's <code>inbox</code> and it is likely that the server will want
          to locally store a representation of this activity and its accompanying
          object.
          However, this mostly happens in general with processing activities
          delivered to an <code>inbox</code> anyway.
        </p>
      </section>

      <section id="update-activity-inbox">
        <h3>Update Activity</h3>
        <p>
          For server to server interactions, an <code>Update</code> activity
          means that the receiving server SHOULD update its copy of the
          <code>object</code> of the same <code>id</code> to the copy
          supplied in the <code>Update</code> activity.
          Unlike the
          <a href="#update-activity-outbox">
            client to server handling of the Update activity</a>,
          this is not a partial update but a complete replacement of the object.
        </p>
        <p>
          The receiving server MUST take care to be sure that the
          <code>Update</code> is authorized to modify its <code>object</code>.
          At minimum, this may be done by ensuring that the <code>Update</code>
          and its <code>object</code> are of same origin.
        </p>
      </section>

      <section id="delete-activity-inbox">
        <h3>Delete Activity</h3>
        <p>
          The side effect of receiving this is that (assuming the
          <code>object</code> is owned by the sending actor / server) the
          server receiving the delete activity SHOULD remove its representation
          of the <code>object</code> with the same <code>id</code>, and MAY
          replace that representation with a <code>Tombstone</code> object.
        </p>
        <p>
          (Note that after an activity has been transmitted from an origin
          server to a remote server, there is nothing in the ActivityPub
          protocol that can <em>enforce</em> remote deletion of an object's
          representation).
        </p>
      </section>

      <section id="follow-activity-inbox">
        <h3>Follow Activity</h3>

        <p>
          The side effect of receiving this in an <strong>inbox</strong> is
          that the server SHOULD generate either an <code>Accept</code> or
          <code>Reject</code> activity with the Follow as the
          <code>object</code> and deliver it to the <code>actor</code> of the
          Follow.
          The <code>Accept</code> or <code>Reject</code> MAY be generated
          automatically, or MAY be the result of user input (possibly after
          some delay in which the user reviews).
          Servers MAY choose to not explicitly send a <code>Reject</code>
          in response to a <code>Follow</code>, though implementors ought to
          be aware that the server sending the request could be left in an
          intermediate state.
          For example, a server might not send a <code>Reject</code> to protect
          a user's privacy.
        </p>

        <p>
          In the case of receiving an <code>Accept</code> referencing this
          <code>Follow</code> as the object, the server SHOULD add the
          <code>actor</code> to the object actor's
          <a href="#followers">Followers Collection</a>.
          In the case of a <code>Reject</code>, the server MUST NOT add the
          actor to the object actor's
          <a href="#followers">Followers Collection</a>.
        </p>

        <div class="note">
          <p>
            Sometimes a successful <code>Follow</code> subscription may
            occur but at some future point delivery to the follower fails
            for an extended period of time.
            Implementations should be aware that there is no guarantee
            that actors on the network will remain reachable and should
            implement accordingly.
            For instance, if attempting to deliver to an actor for perhaps
            six months while the follower remains unreachable, it is
            reasonable that the delivering server remove the subscriber
            from the <code>followers</code> list.
            Timeframes and behavior for dealing with unreachable actors are
            left to the discretion of the delivering server.
          </p>
        </div>
        
      </section>

      <section id="accept-activity-inbox">
        <h3>Accept Activity</h3>
        <p>
          The side effect of receiving this in an <strong>inbox</strong> is
          determined by the type of the <code>object</code> received,
          and it is possible to accept types not described in this document
          (for example, an <code>Offer</code>).
        </p>

        <p>
          If the <code>object</code> of an <code>Accept</code> received to an
          <strong>inbox</strong> is a <code>Follow</code> activity
          previously sent by the receiver, the server SHOULD add the
          <code>actor</code> to the receiver's
          <a href="#following">Following Collection</a>.
        </p>
      </section>
      
      <section id="reject-activity-inbox">
        <h3>Reject Activity</h3>
        <p>
          The side effect of receiving this in an <strong>inbox</strong> is
          determined by the type of the <code>object</code> received,
          and it is possible to reject types not described in this document
          (for example, an <code>Offer</code>).
        </p>

        <p>
          If the <code>object</code> of a <code>Reject</code> received to an
          <strong>inbox</strong> is a <code>Follow</code> activity
          previously sent by the receiver, this means the recipient did not
          approve the <code>Follow</code> request. The server MUST NOT add the
          <code>actor</code> to the receiver's
          <a href="#following">Following Collection</a>.
        </p>
      </section>

      <section id="add-activity-inbox">
        <h3>Add Activity</h3>
        <p>
          Upon receipt of an <code>Add</code> activity into the
          <strong>inbox</strong>, the server SHOULD
          add the <code>object</code> to the collection specified in the
          <code>target</code> property, unless:
        </p>
        <ul>
          <li>
            the <code>target</code> is not owned by the receiving server, and
            thus they can't update it.
          </li>
          <li>
            the <code>object</code> is not allowed to be added to the
            <code>target</code> collection for some other reason, at the
            receiver's discretion.
          </li>
        </ul>
      </section>
      <section id="remove-activity-inbox">
        <h3>Remove Activity</h3>
        <p>
          Upon receipt of a <code>Remove</code> activity into the
          <strong>inbox</strong>, the server SHOULD
          remove the <code>object</code> from the collection specified in the
          <code>target</code> property, unless:
        <ul>
          <li>
            the <code>target</code> is not owned by the receiving server, and
            thus they can't update it.
          </li>
          <li>
            the <code>object</code> is not allowed to be removed to the
            <code>target</code> collection for some other reason, at the
            receiver's discretion.
          </li>
        </ul>
      </section>
      <section id="like-activity-inbox">
        <h3>Like Activity</h3>
        <p>
          The side effect of receiving this in an <strong>inbox</strong> is
          that the server SHOULD increment the object's count of likes by
          adding the received activity to the
          <a href="#likes"><code>likes</code></a> collection
          if this collection is present.
        </p>
      </section>
      <section id="announce-activity-inbox">
        <h3>Announce Activity (sharing)</h3>
        <p>
          Upon receipt of an <code>Announce</code> activity in an
          <strong>inbox</strong>, a server SHOULD increment the object's count
          of shares by adding the received activity to the
          <a href="#shares"><code>shares</code></a> collection
          if this collection is present.
        </p>
        <div class="note">
          The <code>Announce</code> activity is effectively what is known as
          "sharing", "reposting", or "boosting" in other social networks.
        </div>
      </section>
      <section id="undo-activity-inbox">
        <h3>Undo Activity</h3>
        <p>
          The <code>Undo</code> activity is used to undo the side effects
          of previous activities.
          See the ActivityStreams documentation on
          <a href="https://www.w3.org/TR/activitystreams-vocabulary/#inverse">
            Inverse Activities and "Undo"</a>.
          The scope and restrictions of the <code>Undo</code> activity
          are the same as for
          <a href="#undo-activity-outbox">
            the Undo activity in the context of client to server
            interactions</a>,
          but applied to a federated context.
        </p>
      </section>
    </section>

    <section id="i18n-concerns" class="appendix informative">
      <h2>Internationalization</h2>
      <p>
        Building an international base of users is important in a federated
        network.
        <a href="https://www.w3.org/TR/activitystreams-core/#naturalLanguageValues">
          ActivityStreams provides tooling for internationalization of content</a>,
        which should be used whenever possible.
        However, it can be difficult for implementations to determine which
        <a href="https://www.w3.org/TR/activitystreams-core/#defaultlangcontext">
          <code>@language</code> property</a>
        to provide for user-submitted content.
        The
        <a href="https://www.w3.org/International/">W3C Internationalization group</a>
        provides some
        <a href="https://www.w3.org/International/wiki/LanguageDetection">
          guidance on language detection</a>.
      </p>
    </section>

    <section id="security-considerations" class="appendix informative">
      <h2>Security Considerations</h2>
      
      <section id="authorization">
        <h3>Authentication and Authorization</h3>
        <p>
          ActivityPub uses authentication for two purposes; first, to
          authenticate clients to servers, and secondly in federated
          implementations to authenticate servers to each other.
        </p>

        <p>
          Unfortunately at the time of standardization, there are no strongly
          agreed upon mechanisms for authentication.
          Some possible directions for authentication are laid out 
          <a href="https://www.w3.org/wiki/SocialCG/ActivityPub/Authentication_Authorization">in 
          the Social Web Community Group Authentication and 
          Authorization best practices report</a>.
        </p>

      </section>

      <section id="security-verification">
        <h2>Verification</h2>
        <p>
          Servers should not trust client submitted content, and
          federated servers also should not trust content received from a server
          other than the content's origin without some form of verification.
        </p>
        <p>
          Servers should be careful to verify that new content is really posted
          by the actor that claims to be posting it, and that the actor has
          permission to update the resources it claims to.
          See also
          <a href="#obj"></a> and <a href="#authorization"></a>.
        </p>
      </section>

      <section id="security-localhost">
        <h2>Accessing localhost URIs</h2>
        <p>
          It is often convenient while developing to test against a process
          running on localhost.
          However, permitting requests to localhost in a production client or
          server instance can be dangerous.
          Making requests to URIs on localhost which do not require
          authorization may unintentionally access or modify resources assumed
          to be protected to be usable by localhost-only.
        </p>
        <p>
          If your ActivityPub server or client does permit making requests to
          localhost URIs for development purposes, consider making it a
          configuration option which defaults to off.
        </p>
      </section>

      <section id="security-uri-schemes">
        <h2>URI Schemes</h2>
        <p>
          There are many types of URIs aside from just <code>http</code> and
          <code>https</code>.
          Some libraries which handle fetching requests at various URI schemes
          may try to be smart and reference schemes which may be undesirable,
          such as <code>file</code>.
          Client and server authors should carefully check how their libraries
          handle requests, and potentially whitelist only certain safe URI
          types, such as <code>http</code> and <code>https</code>.
        </p>
      </section>

      <section id="security-recursive-objects">
        <h2>Recursive Objects</h2>
        <p>
          Servers should set a limit on how deep to recurse while resolving objects,
          or otherwise specially handle ActivityStreams objects with recursive
          references.
	  Failure to properly do so may result in denial-of-service security
	  vulnerabilities.
        </p>
      </section>

      <section id="security-spam">
        <h2>Spam</h2>
        <p>
          Spam is a problem in any network, perhaps especially so in federated
          networks.
          While no specific mechanism for combating spam is provided in
          ActivityPub, it is recommended that servers filter incoming content
          both by local untrusted users and any remote users through some
          sort of spam filter.
        </p>
      </section>

      <section id="security-federation-dos">
        <h2>Federation denial-of-service</h2>
          <p>
            Servers should implement protections against denial-of-service
            attacks from other, federated servers.
            This can be done using, for example, some kind of ratelimiting
            mechanism.
            Servers should be especially careful to implement this protection
            around activities that involve side effects.
            Servers SHOULD also take care not to overload servers with
            submissions, for example by using an exponential backoff strategy.
          </p>
      </section>

      <section id="security-c2s-ratelimiting">
        <h2>Client-to-server ratelimiting</h2>
          <p>
            Servers should ratelimit API client submissions.
            This serves two purposes:
            <ol>
              <li>
                It prevents malicious clients from conducting
                denial-of-service attacks on the server.
              </li>
              <li>
                It ensures that the server will not distribute so many
                activities that it triggers another
                server's <a href="#security-federation-dos">denial-of-service
                protections</a>.
              </li>
            </ol>
          </p>
      </section>

      <section id="security-c2s-response-dos">
        <h2>Client-to-server response denial-of-service</h2>
        <p>
          In order to prevent a client from being overloaded by oversized
          Collections, servers should take care to limit the size of Collection 
          pages they return to clients.
          Clients should still be prepared to limit the size of
          responses they are willing to handle in case they connect to malicious or
          compromised servers, for example by timing out and generating
          an error.
        </p>
      </section>

      <section id="security-sanitizing-content">
        <h2>Sanitizing Content</h2>
        <p>
          Any activity field being rendered for browsers (or other rich
          text enabled applications) should take care to sanitize fields
          containing markup to prevent cross site scripting attacks.
        </p>
      </section>

      <section id="security-not-displaying-bto-bcc">
        <h2>Not displaying bto and bcc properties</h2>
        <p>
          <code>bto</code> and <code>bcc</code> already
          <a href="#remove-bto-bcc-before-delivery">must be removed for delivery</a>,
          but servers are free to decide how to represent the object
          in their own storage systems.
          However, since <code>bto</code> and <code>bcc</code> are only intended
          to be known/seen by the original author of the object/activity,
          servers should omit these properties during display as well.
        </p>
      </section>
    </section>

    <section class="appendix informative" id="acknowledgements">
      <h2>Acknowledgements</h2>
      <p>
        This specification comes from years of hard work and experience by a
        number of communities exploring the space of federation on the web.
        In particular, much of this specification is informed by
        <a href="https://www.w3.org/community/ostatus/wiki/Main_Page">OStatus</a>
        and the
        <a href="https://github.com/pump-io/pump.io/blob/master/API.md">Pump API</a>,
        as pioneered by StatusNet (now GNU Social) and Pump.io.
        Both of those initiatives were the product of many developers' hard work,
        but more than anyone, Evan Prodromou has been a constant leader in this
        space, and it is unlikely that ActivityPub would exist in something
        resembling its current state without his hard work.
      </p>

      <p>
        Erin Shepherd built the initial version of this specification, borrowed
        from the ideas in the
        <a href="https://github.com/pump-io/pump.io/blob/master/API.md">Pump API</a>
        document, mostly as a complete rewrite of text, but sharing most of
        the primary ideas while switching from ActivityStreams 1 to
        ActivityStreams 2.
      </p>

      <p>
        Jessica Tallon and Christopher Lemmer Webber took over as editors when
        the standard moved to the W3C Social Working Group and did the majority
        of transition from Erin Shepherd's document to its current state as
        ActivityPub.
        Much of the document was rewritten and reorganized under the long feedback
        process of the Social Working Group.
      </p>

      <p>
        ActivityPub has been shaped by the careful input of many members in the
        W3C Social Working Group.
        ActivityPub especially owes a great debt to Amy Guy, who has done more
        than anyone to map the ideas across the different Social Working Group
        documents through her work on [[Social-Web-Protocols]].
        Amy also laid out the foundations for a significant refactoring of the
        ActivityPub spec while sprinting for four days with Christopher Allan
        Webber.
        These revisions lead to cleaner separation between the client to server
        and server components, along with clarity about ActivityPub's relationship
        to [[!LDN]], among many other improvements.
        Special thanks also goes to Benjamin Goering for putting together the
        implementation report template.
        We also thank mray for producing the spectacular tutorial illustrations
        (which are licensed under the same license as the rest of this
        document).
      </p>

      <p>
        Many people also helped ActivityPub along through careful review.
        In particular, thanks to:
        Aaron Parecki,
        AJ Jordan,
        Benjamin Goering,
        Caleb Langeslag,
        Elsa Balderrama,
        elf Pavlik,
        Eugen Rochko,
        Erik Wilde,
        Jason Robinson,
        Manu Sporny,
        Michael Vogel,
        Mike Macgirvin,
        nightpool,
        Puck Meerburg,
        Sandro Hawke,
        Sarven Capadisli,
        Tantek Çelik, and
        Yuri Volkov.
      </p>

      <p>
        This document is dedicated to all citizens of planet Earth.
        You deserve freedom of communication; we hope we have contributed in
        some part, however small, towards that goal and right.
      </p>
    </section>
  </body>
</html>
